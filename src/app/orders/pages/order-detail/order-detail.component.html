<section class="order-detail" *ngIf="order$ | async as order; else notFound">
  <header class="order-detail__header">
    <div>
      <h1>Pedido {{ order.code }}</h1>
      <p>Creado el {{ order.createdAt | date:'medium' }}</p>
    </div>
    <div class="order-detail__actions">
      <select [value]="order.status" (change)="updateStatus(order, $any($event.target).value)">
        <option *ngFor="let status of statusOptions" [value]="status">{{ statusLabels[status] }}</option>
      </select>
      <button type="button" (click)="goBack()">Volver</button>
    </div>
  </header>

  <section class="order-detail__info">
    <article>
      <h2>Cliente</h2>
      <p class="order-detail__customer">{{ order.customerName }}</p>
      <p *ngIf="order.customerEmail">{{ order.customerEmail }}</p>
      <p *ngIf="order.notes" class="order-detail__notes">{{ order.notes }}</p>
    </article>
    <article>
      <h2>Entrega</h2>
      <p>Fecha estimada: {{ order.expectedDelivery | date:'mediumDate' }}</p>
      <p>Estado: <span class="badge" [class]="'badge ' + (order.status | lowercase)">{{ statusLabels[order.status] }}</span></p>
    </article>
    <article>
      <h2>Resumen</h2>
      <p>Subtotal: <strong>{{ order.subtotal | currency:'USD':'symbol':'1.0-0' }}</strong></p>
      <p>Impuestos: <strong>{{ order.tax | currency:'USD':'symbol':'1.0-0' }}</strong></p>
      <p>Total: <strong>{{ order.total | currency:'USD':'symbol':'1.0-0' }}</strong></p>
    </article>
  </section>

  <section class="order-detail__items">
    <h2>Productos</h2>
    <table>
      <thead>
        <tr>
          <th>Referencia</th>
          <th>Varietal</th>
          <th>Cosecha</th>
          <th>Cantidad</th>
          <th>Precio unitario</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of order.items">
          <td>
            <span class="item-name">{{ item.catalogItem.name }}</span>
            <small>{{ item.catalogItem.origin }}</small>
          </td>
          <td>{{ item.catalogItem.varietal }}</td>
          <td>{{ item.catalogItem.vintage }}</td>
          <td>{{ item.quantity }}</td>
          <td>{{ item.unitPrice | currency:'USD':'symbol':'1.0-0' }}</td>
          <td>{{ item.lineTotal | currency:'USD':'symbol':'1.0-0' }}</td>
        </tr>
      </tbody>
    </table>
  </section>
</section>

<ng-template #notFound>
  <div class="order-detail__empty">
    <h2>Pedido no encontrado</h2>
    <p>El identificador proporcionado no coincide con ning√∫n pedido registrado.</p>
    <a routerLink="/dashboard/sales">Volver al listado</a>
  </div>
</ng-template>

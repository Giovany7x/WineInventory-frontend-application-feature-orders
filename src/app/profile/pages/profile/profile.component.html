<div class="profile-layout">
  <section class="workspace">
    <header class="workspace__header">
      <div class="header__title">
        <div class="header__icon material-symbols-outlined">badge</div>
        <div>
          <h1>{{ isSettingsView() ? 'Ajustes' : 'Perfil' }}</h1>
          <p *ngIf="!isSettingsView()">Gestiona tu información personal, credenciales y plan de suscripción.</p>
          <p *ngIf="isSettingsView()">Actualiza tus datos personales y preferencias de acceso.</p>
        </div>
      </div>

      <div class="header__status-chip" *ngIf="accountStatus() as status">
        <span class="material-symbols-outlined">verified</span>
        {{ status.statusLabel }}
      </div>
    </header>

    <p class="workspace__error" *ngIf="loadError() as errorMessage">{{ errorMessage }}</p>

    <ng-container *ngIf="!isLoading(); else loading">
      <ng-container *ngIf="profile() as currentProfile; else emptyProfile">
        <div class="workspace__grid">
          <app-profile-edit
            [profile]="currentProfile"
            [saving]="isSaving()"
            [errorMessage]="updateError()"
            (saveProfile)="handleProfileSave($event)"
            (cancelEdit)="handleCancelEdit()"
          ></app-profile-edit>

          <article class="card account-card" *ngIf="accountStatus() as status">
            <header class="card__header">
              <h2>Tipo de cuenta</h2>
              <span class="status-chip status-chip--active">
                <span class="material-symbols-outlined">workspace_premium</span>
                {{ status.statusLabel }}
              </span>
            </header>
            <div class="account-card__body">
              <p class="account-card__plan">{{ status.planName }}</p>
              <p class="account-card__subtitle">
                Tu plan se renovará automáticamente el {{ status.renewalDate | date: 'dd MMMM yyyy' }}.
              </p>
              <div class="account-card__actions">
                <button
                  type="button"
                  class="primary-button"
                  (click)="selectedPlanId() && handlePlanSelected(selectedPlanId()!)"
                  [disabled]="isSaving() || !selectedPlanId()"
                >
                  Mantener plan actual
                </button>
                <button type="button" class="ghost-button" [disabled]="isSaving()">
                  Contactar soporte
                </button>
              </div>
              <p class="account-card__support">
                ¿Necesitas ayuda? Escríbenos a
                <a [href]="'mailto:' + status.supportContact">{{ status.supportContact }}</a>.
              </p>
            </div>
          </article>

          <app-plan-details
            [plans]="plans()"
            [selectedPlanId]="selectedPlanId()"
            [disabled]="isSaving()"
            (planSelected)="handlePlanSelected($event)"
          ></app-plan-details>

          <app-plan-benefits [benefits]="premiumBenefits()"></app-plan-benefits>
        </div>
      </ng-container>
    </ng-container>
  </section>
</div>

<ng-template #loading>
  <div class="workspace__loading">
    <span class="material-symbols-outlined">hourglass_empty</span>
    Cargando información del perfil…
  </div>
</ng-template>

<ng-template #emptyProfile>
  <div class="workspace__empty">
    <span class="material-symbols-outlined">person_off</span>
    No encontramos información del perfil para mostrar.
  </div>
</ng-template>
